{% extends 'base.html' %}




{% block content_search %}
    <div class="card-header">
        <br>
        <div class="row">
            <center><h1>Estadistica</h1></center>
            <div class="col-md-2"></div>
            <div class="col-md-8">
                 <div class="col-md-12">
                    <div class="col-md-6 pr-1">
                        <div class="form-group">
                            <label class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input">
                                <span class="custom-control-indicator"></span>
                                <span class="custom-control-description">Departamento</span>
                            </label>
                        </div>
                    </div>
                    <div class="col-md-6 pr-1">
                        <div class="form-group">
                            <label class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input">
                                <span class="custom-control-indicator"></span>
                                <span class="custom-control-description">Distrito</span>
                            </label>
                        </div>
                    </div>
                     <div class="col-md-6 pr-1">
                        <div class="form-group">
                            <label class="custom-control custom-checkbox">
                                <input type="checkbox" class="custom-control-input">
                                <span class="custom-control-indicator"></span>
                                <span class="custom-control-description">zona rural</span>
                            </label>
                        </div>
                    </div>

                 </div>
            </div>
            <div class="col-md-2"></div>
        </div>

    </div>
{% endblock content_search %}

{% block content_body %}
    <div class="card-body">
        <div class="content">

            <div class="row">
               <canvas id="bar-chart" width="800" height="300"></canvas>
            </div>
             <div class="row">
               <canvas id="pie-chart" width="800" height="300"></canvas>
            </div>

             <div class="row">
               <canvas id="bar-chart-grouped" width="800" height="300"></canvas>
            </div>


            <div class="row"
                <div id="container2"></div>
            </div>
        </div>


    </div>
{% endblock content_body %}

{% block javascript %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/proj4js/2.3.15/proj4.js"></script>
<script src="https://code.highcharts.com/highcharts.js"></script>
<script src="https://code.highcharts.com/maps/modules/map.js"></script>
<script src="https://code.highcharts.com/maps/modules/exporting.js"></script>
<script src="https://code.highcharts.com/maps/modules/offline-exporting.js"></script>
<script src="https://code.highcharts.com/mapdata/countries/pe/pe-all.js"></script>

<script type="text/javascript">
    new Chart(document.getElementById("bar-chart"), {
    type: 'bar',
    data: {
      labels: ["lima", "tacna", " lambayqye", "Piura", "Puno"],
      datasets: [
        {
          label: "Population (millions)",
          backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
          data: [2478,5267,734,784,433]
        }
      ]
    },
    options: {
      legend: { display: false },
      title: {
        display: true,
        text: 'Predicted world population '
      }
    }
});

    new Chart(document.getElementById("pie-chart"), {
    type: 'pie',
    data: {
      labels: ["Amazonas", "Ancash", "Apurímac", "Ayacucho America", "Cajamrca", "Cusco"],
      datasets: [{
        label: "Population (millions)",
        backgroundColor: ["#3e95cd", "#8e5ea2","#3cba9f","#e8c3b9","#c45850"],
        data: [2478,5267,734,784,433]
      }]
    },
    options: {
      title: {
        display: true,
        text: 'Predicted world population (millions) in 2050'
      }
    }
});


    new Chart(document.getElementById("bar-chart-grouped"), {
    type: 'bar',
    data: {
      labels: ["costa", "sierra", "selva"],
      datasets: [
        {
          label: "costa",
          backgroundColor: "#3e95cd",
          data: [133,221,783,2478]
        }, {
          label: "sierra",
          backgroundColor: "#8e5ea2",
          data: [408,547,675,734]
        },
          {
          label: "selva",
          backgroundColor: "#8eff2",
          data: [408,547,675,734]
        }
      ]
    },
    options: {
      title: {
        display: true,
        text: 'Population growth (millions)'
      }
    }
});



    new Highcharts.seriesType('mappie', 'pie', {
    center: null, // Can't be array by default anymore
    clip: true, // For map navigation
    states: {
        hover: {
            halo: {
                size: 5
            }
        }
    },
    dataLabels: {
        enabled: false
    }
}, {
    getCenter: function () {
        var options = this.options,
            chart = this.chart,
            slicingRoom = 2 * (options.slicedOffset || 0);
        if (!options.center) {
            options.center = [null, null]; // Do the default here instead
        }
        // Handle lat/lon support
        if (options.center.lat !== undefined) {
            var point = chart.fromLatLonToPoint(options.center);
            options.center = [
                chart.xAxis[0].toPixels(point.x, true),
                chart.yAxis[0].toPixels(point.y, true)
            ];
        }
        // Handle dynamic size
        if (options.sizeFormatter) {
            options.size = options.sizeFormatter.call(this);
        }
        // Call parent function
        var result = Highcharts.seriesTypes.pie.prototype.getCenter.call(this);
        // Must correct for slicing room to get exact pixel pos
        result[0] -= slicingRoom;
        result[1] -= slicingRoom;
        return result;
    },
    translate: function (p) {
        this.options.center = this.userOptions.center;
        this.center = this.getCenter();
        return Highcharts.seriesTypes.pie.prototype.translate.call(this, p);
    }
});


var data = [
        // state, demVotes, repVotes, libVotes, grnVotes, sumVotes, winner, offset config for pies
        ['Lima', 729547, 1318255, 44467, 9391, 2101660, -1],
        ['Arequipa', 116454, 163387, 18725, 5735, 304301, -1],
        ['Amazonas', 1161167, 1252401, 106327, 34345, 2554240, -1],
        ['Ancash', 380494, 684782, 29829, 9473, 1104578, -1],
        ['Tumbes', 8577206, 4390272, 467370, 271047, 13705895, 1, { lon: -1, drawConnector: false }],
        ['Lambayeque', 729547, 1318255, 44467, 9391, 2101660, -1],
        ['Huánuco', 116454, 163387, 18725, 5735, 304301, -1],
        ['La Libertad', 1161167, 1252401, 106327, 34345, 2554240, -1],
        ['Loreto', 729547, 1318255, 44467, 9391, 2101660, -1],
        ['Madre de Dios', 116454, 163387, 18725, 5735, 2101660, -1],
        ['Moquegua', 1161167, 1252401, 106327, 34345, 34345, -1],
        ['Pasco', 380494, 684782, 29829, 9473, 1104578, -1],
        ['Piura', 8577206, 4390272, 467370, 271047, 13705895, 1, { lon: -1, drawConnector: false }],
        ['San Martín', 729547, 1318255, 44467, 9391, 2101660, -1],
        ['Tacna', 116454, 163387, 2101660, 5735, 304301, -1],
        ['Ucayali', 1161167, 1252401, 106327, 34345, 2554240, -1],
        ['Cajamarca', 8577206, 4390272, 467370, 271047, 13705895, 1, { lon: -1, drawConnector: false }],
        ['Cusco', 729547, 1318255, 44467, 9391, 2101660, -1],
        ['Apurímac', 729547, 1318255, 44467, 9391, 2101660, -1],
        ['Ayacucho', 729547, 1318255, 44467, 9391, 2101660, -1, ],
        ['Ica', 8577206, 4390272, 467370, 271047, 13705895, 1, { lon: -1, drawConnector: false }],
        ['Huancavelica', 8577206, 4390272, 467370, 271047, 13705895, 1, { lon: -1, drawConnector: false }],
         ['Pasco', 8577206, 4390272, 467370, 271047, 13705895, 1, { lon: -1, drawConnector: false }],
         ['Junín', 729547, 1318255, 44467, 9391, 2101660, -1],
    ],

    maxVotes = 0,
    demColor = 'rgba(74,131,240,0.80)',
    repColor = 'rgba(220,71,71,0.80)',
    libColor = 'rgba(240,190,50,0.80)',
    grnColor = 'rgba(90,200,90,0.80)';


// Compute max votes to find relative sizes of bubbles
Highcharts.each(data, function (row) {
    maxVotes = Math.max(maxVotes, row[5]);
});

// Build the chart
var chart = Highcharts.mapChart('container2', {
    title: {
        text: 'Opinión de Voto'
    },

    chart: {
        animation: false // Disable animation, especially for zooming
    },

    colorAxis: {
        dataClasses: [{
            from: -1,
            to: 0,
            color: 'rgba(244,91,91,0.5)',
            name: 'A Favor'
        }, {
            from: 0,
            to: 1,
            color: 'rgba(124,181,236,0.5)',
            name: 'En Contra'
        }, {
            from: 2,
            to: 3,
            name: 'No Sabe No Opina',
            color: libColor
        }]
    },

    mapNavigation: {
        enabled: true
    },
    // Limit zoom range
    yAxis: {
        minRange: 2300
    },

    tooltip: {
        useHTML: true
    },

    // Default options for the pies
    plotOptions: {
        mappie: {
            borderColor: 'rgba(255,255,255,0.4)',
            borderWidth: 1,
            tooltip: {
                headerFormat: ''
            }
        }
    },

    series: [{
        mapData: Highcharts.maps['countries/pe/pe-all'],
        data: data,
        name: 'States',
        borderColor: '#FFF',
        showInLegend: false,
        joinBy: ['name', 'id'],
        keys: ['id', 'demVotes', 'repVotes', 'libVotes', 'grnVotes',
            'sumVotes', 'value', 'pieOffset'],
        tooltip: {
            headerFormat: '',
            pointFormatter: function () {
                var hoverVotes = this.hoverVotes; // Used by pie only
                return '<b>' + this.id + ' votes</b><br/>' +
                    Highcharts.map([
                        ['En Contra', this.demVotes, demColor],
                        ['A Favor', this.repVotes, repColor],
                        ['No SAbe No Opina', this.libVotes, libColor],

                    ].sort(function (a, b) {
                        return b[1] - a[1]; // Sort tooltip by most votes
                    }), function (line) {
                        return '<span style="color:' + line[2] +
                            // Colorized bullet
                            '">\u25CF</span> ' +
                            // Party and votes
                            (line[0] === hoverVotes ? '<b>' : '') +
                            line[0] + ': ' +
                            Highcharts.numberFormat(line[1], 0) +
                            (line[0] === hoverVotes ? '</b>' : '') +
                            '<br/>';
                    }).join('') +
                    '<hr/>Total: ' + Highcharts.numberFormat(this.sumVotes, 0);
            }
        }
    }, {
        name: 'Separators',
        type: 'mapline',
        data: Highcharts.geojson(Highcharts.maps['countries/pe/pe-all'], 'mapline'),
        color: '#707070',
        showInLegend: false,
        enableMouseTracking: false
    }, {
        name: 'Connectors',
        type: 'mapline',
        color: 'rgba(130, 130, 130, 0.5)',
        zIndex: 6,
        showInLegend: false,
        enableMouseTracking: false
    }]
});

// When clicking legend items, also toggle connectors and pies
Highcharts.each(chart.legend.allItems, function (item) {
    var old = item.setVisible;
    item.setVisible = function () {
        var legendItem = this;
        old.call(legendItem);
        Highcharts.each(chart.series[0].points, function (point) {
            if (chart.colorAxis[0].dataClasses[point.dataClass].name === legendItem.name) {
                // Find this state's pie and set visibility
                Highcharts.find(chart.series, function (item) {
                    return item.name === point.id;
                }).setVisible(legendItem.visible, false);
                // Do the same for the connector point if it exists
                var connector = Highcharts.find(chart.series[2].points, function (item) {
                    return item.name === point.id;
                });
                if (connector) {
                    connector.setVisible(legendItem.visible, false);
                }
            }
        });
        chart.redraw();
    };
});

// Add the pies after chart load, optionally with offset and connectors
Highcharts.each(chart.series[0].points, function (state) {
    if (!state.id) {
        return; // Skip points with no data, if any
    }

    var pieOffset = state.pieOffset || {},
        centerLat = parseFloat(state.properties.latitude),
        centerLon = parseFloat(state.properties.longitude);

    // Add the pie for this state
    chart.addSeries({
        type: 'mappie',
        name: state.id,
        zIndex: 6, // Keep pies above connector lines
        sizeFormatter: function () {
            var yAxis = this.chart.yAxis[0],
                zoomFactor = (yAxis.dataMax - yAxis.dataMin) /
                    (yAxis.max - yAxis.min);
            return Math.max(
                this.chart.chartWidth / 45 * zoomFactor, // Min size
                this.chart.chartWidth / 11 * zoomFactor * state.sumVotes / maxVotes
            );
        },
        tooltip: {
            // Use the state tooltip for the pies as well
            pointFormatter: function () {
                return state.series.tooltipOptions.pointFormatter.call({
                    id: state.id,
                    hoverVotes: this.name,
                    demVotes: state.demVotes,
                    repVotes: state.repVotes,
                    libVotes: state.libVotes,
                    grnVotes: state.grnVotes,
                    sumVotes: state.sumVotes
                });
            }
        },
        data: [{
            name: 'Democrats',
            y: state.demVotes,
            color: demColor
        }, {
            name: 'Republicans',
            y: state.repVotes,
            color: repColor
        }, {
            name: 'Libertarians',
            y: state.libVotes,
            color: libColor
        }, {
            name: 'Green',
            y: state.grnVotes,
            color: grnColor
        }],
        center: {
            lat: centerLat + (pieOffset.lat || 0),
            lon: centerLon + (pieOffset.lon || 0)
        }
    }, false);

    // Draw connector to state center if the pie has been offset
    if (pieOffset.drawConnector !== false) {
        var centerPoint = chart.fromLatLonToPoint({
                lat: centerLat,
                lon: centerLon
            }),
            offsetPoint = chart.fromLatLonToPoint({
                lat: centerLat + (pieOffset.lat || 0),
                lon: centerLon + (pieOffset.lon || 0)
            });
        chart.series[2].addPoint({
            name: state.id,
            path: 'M' + offsetPoint.x + ' ' + offsetPoint.y +
                'L' + centerPoint.x + ' ' + centerPoint.y
        }, false);
    }
});
// Only redraw once all pies and connectors have been added
chart.redraw();

</script>
<style type="text/css">
#container2 {
    min-width: 320px;
    max-width: 800px;
    height: 500px;
    margin: 1em auto;
}
</style>

{% endblock javascript %}